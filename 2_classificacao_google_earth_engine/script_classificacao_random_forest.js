var floresta = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([-43.02107549377292, -22.9004206411459]),
            {
              "class": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.02725530334323, -22.913703033669083]),
            {
              "class": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.05334783264011, -22.922557239042]),
            {
              "class": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.005969292601044, -22.902950720983238]),
            {
              "class": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([-42.98468328185886, -22.92445449349581]),
            {
              "class": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.00184941955417, -22.94342557644016]),
            {
              "class": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.01283574767917, -22.957336014316766]),
            {
              "class": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.07806707092136, -22.922557239042]),
            {
              "class": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.07703710265964, -22.927932724320172]),
            {
              "class": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.08699346252292, -22.932359434378203]),
            {
              "class": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.093859917601044, -22.940580083444985]),
            {
              "class": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.10278630920261, -22.939947743545243]),
            {
              "class": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.10587621398776, -22.945954853328434]),
            {
              "class": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.062077175950044, -22.892639456524545]),
            {
              "class": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.03813067279648, -22.890777841718396]),
            {
              "class": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.040448101385344, -22.89188483613548]),
            {
              "class": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.04250803790878, -22.892517400319104]),
            {
              "class": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.047915371282805, -22.894256936618405]),
            {
              "class": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.050146969183196, -22.89283368130507]),
            {
              "class": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.048945339544524, -22.894415075176077]),
            {
              "class": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.060017498358, -22.89243832995743]),
            {
              "class": 1,
              "system:index": "20"
            })]),
    urbano = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([-43.112910291365424, -22.904612006770897]),
            {
              "class": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.103640577009955, -22.905837482211364]),
            {
              "class": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.10604766855832, -22.900936506874555]),
            {
              "class": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.08905319223996, -22.91698583965678]),
            {
              "class": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.104159393411834, -22.907498778931547]),
            {
              "class": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.10673431406613, -22.909554365097833]),
            {
              "class": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.111369171243865, -22.905443161601152]),
            {
              "class": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12060199561809, -22.895169342401235]),
            {
              "class": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12055908027385, -22.893429817799916]),
            {
              "class": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12609515968059, -22.88366434527987]),
            {
              "class": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12412105384563, -22.885324920553767]),
            {
              "class": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.126695974499924, -22.888646010154993]),
            {
              "class": 2,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12729678931926, -22.887064549051413]),
            {
              "class": 2,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.13021503272746, -22.884850472548422]),
            {
              "class": 2,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.11811290565227, -22.89133445173709]),
            {
              "class": 2,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.1073840695927, -22.8831108156743]),
            {
              "class": 2,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.106182439954026, -22.884376022884755]),
            {
              "class": 2,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.08712802711223, -22.88303173983211]),
            {
              "class": 2,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.08438144508098, -22.885324920553767]),
            {
              "class": 2,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.09562526527141, -22.88599631782079]),
            {
              "class": 2,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.093222005994065, -22.890266254115556]),
            {
              "class": 2,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.056571745892846, -22.9093962225377]),
            {
              "class": 2,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.059833312054955, -22.904494382976015]),
            {
              "class": 2,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.06566979887136, -22.909000919465015]),
            {
              "class": 2,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.06927468778738, -22.911214601826405]),
            {
              "class": 2,
              "system:index": "24"
            })]),
    agua = /* color: #164eff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([-43.11656739713796, -22.908289371029706]),
            {
              "class": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.11467912199148, -22.910503065009383]),
            {
              "class": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.1186273336614, -22.910186825225278]),
            {
              "class": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.11656739713796, -22.912558605624533]),
            {
              "class": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.06850221159109, -22.94623340726607]),
            {
              "class": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.07845857145437, -22.949078781407394]),
            {
              "class": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.07227876188406, -22.945917250890698]),
            {
              "class": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.0856683492864, -22.94749802538169]),
            {
              "class": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.04103639127859, -22.961724164743263]),
            {
              "class": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.04240968229421, -22.962040284179924]),
            {
              "class": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.06850221159109, -22.962672520836318]),
            {
              "class": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.07845857145437, -22.962040284179924]),
            {
              "class": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.08601167204031, -22.958879056560715]),
            {
              "class": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.092534804364526, -22.959195182647797]),
            {
              "class": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.11347749235281, -22.957614544823475]),
            {
              "class": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.11759736539968, -22.946865717801085]),
            {
              "class": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.12618043424734, -22.941807150803513]),
            {
              "class": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.13407685758718, -22.929159906293787]),
            {
              "class": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.107297682782495, -22.923468260917726]),
            {
              "class": 3,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([-43.09871461393484, -22.921570992653255]),
            {
              "class": 3,
              "system:index": "19"
            })]);

var geometry = 
    /* color: #d63000 */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-43.14809883421687, -22.843250497463224],
          [-43.14809883421687, -22.98997891584446],
          [-42.94897163695124, -22.98997891584446],
          [-42.94897163695124, -22.843250497463224]]], null, false);
          
var trainingData = floresta.merge(urbano).merge(agua);
console.log(trainingData);

function maskS2clouds(image) {
  var qa = image.select('QA60');
  // Bits 10 and 11 are clouds and cirrus, respectively.
  var cloudBitMask = 1 << 10;
  var cirrusBitMask = 1 << 11;
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0)
      .and(qa.bitwiseAnd(cirrusBitMask).eq(0));

  return image.updateMask(mask).divide(10000);
}

var image = ee.ImageCollection("COPERNICUS/S2")
.filterDate('2022-01-01', '2022-12-31')
.filterBounds(geometry)
.filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 20))
.map(maskS2clouds)
.map(function(img){return img.clip(geometry)})
.median()
.select(['B2','B3','B4','B8']);

console.log(image);

var bands = ['B2', 'B3', 'B4', 'B8'];

//Criando amostras de treinamento
var training = image.select(bands).sampleRegions({
  collection: trainingData,
  properties: ['class'],
  scale: 10
});

// Treinando classificador
var classifier = ee.Classifier.smileRandomForest(100).train({
  features: training,
  classProperty: 'class',
  inputProperties: bands
});

// Fazendo classificaç~ão
var classified = image.select(bands).classify(classifier);

Map.addLayer(image.select(['B8']), {min: 0, max: 0.7}, 'sentinel');

Map.centerObject(geometry, 12);

Map.addLayer(classified, {
  min: 1,
  max: 3,
  palette: ['green', 'red', 'blue']
}, 'classification');

